---
title: "探索Java：JNI小试"
date: 2017-12-24
draft: false
tags:
  - "Java"
  - "JNI"
  - "编程语言"
---

# 1. Java代码

```java
package com.github.manxisuo;

public class TestJNI
{
    static
    {
        System.loadLibrary("Hello");
    }

    public static native int get();
    public static native void set(int i);

    public static void main(String[] args)
    {
        set(10);
        int r = get();
        System.out.println("The result is " + r);
    }
}
```

# 2. 生成头文件

```shell
javah -jni com.github.manxisuo.TestJNI
```

将会生成com_github_manxisuo_TestJNI.h文件。

```c
/* DO NOT EDIT THIS FILE - it is machine generated */
#include <jni.h>
/* Header for class com_github_manxisuo_TestJNI */

#ifndef _Included_com_github_manxisuo_TestJNI
#define _Included_com_github_manxisuo_TestJNI
#ifdef __cplusplus
extern "C" {
#endif
/*
 * Class:     com_github_manxisuo_TestJNI
 * Method:    get
 * Signature: ()I
 */
JNIEXPORT jint JNICALL Java_com_github_manxisuo_TestJNI_get
  (JNIEnv *, jclass);

/*
 * Class:     com_github_manxisuo_TestJNI
 * Method:    set
 * Signature: (I)V
 */
JNIEXPORT void JNICALL Java_com_github_manxisuo_TestJNI_set
  (JNIEnv *, jclass, jint);

#ifdef __cplusplus
}
#endif
#endif

```

# 3. C/C++代码

TestJNI.cpp文件：

```cpp
#include <jni.h>
#include "com_github_manxisuo_TestJNI.h"

int i = 0;

JNIEXPORT jint JNICALL Java_com_github_manxisuo_TestJNI_get (JNIEnv *, jclass)
{
    return i;
}

JNIEXPORT void JNICALL Java_com_github_manxisuo_TestJNI_set (JNIEnv *, jclass, jint j)
{
    i = j;
}
```

# 3. 编译成动态链接库

```shell
gcc -fPIC -shared -I/usr/local/jdk1.7.0_01/include -I/usr/local/jdk1.7.0_01/include/linux libHello.cpp -o libHello.so
```

注意：在linux下，在查找库文件时，会在库名称前加上`lib`前缀。因此，库名称为`Hello`时，库文件的名称应该是`libHello`。

# 4. 运行Java代码

结果如下：

```
The result is 10
```

参考：[Java programming with JNI](https://www.ibm.com/developerworks/java/tutorials/j-jni/j-jni.html)